webpackJsonp([53],{1066:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=e.openId;return(0,y.default)("/api/common/select",{method:"POST",body:{code:"select_weixin_openid",args:[{key:"code",value:[t]}]}})}function o(e){return(0,y.default)("/api/service/order",{method:"post",body:(0,d.default)(e)})}function u(e){return(0,y.default)("/api/pay.do",{method:"post",body:(0,d.default)(e)})}Object.defineProperty(t,"__esModule",{value:!0}),t.getDetailsAddress=t.getWeiXinConfig=t.ccbDragonPay=t.wxPartyDuesChannelPay=t.unionPay=t.wxPay=t.userBinding=t.bind=void 0;var c=r(60),i=n(c),s=r(97),d=n(s),l=r(96),f=n(l);t.bind=function(){var e=(0,f.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,y.default)("/api/wechat/inlet",{method:"post",body:(0,d.default)(t)}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.userBinding=function(){var e=(0,f.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,y.default)("/api/mem/userBinding",{method:"post",body:(0,d.default)(t)}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.wxPay=function(){var e=(0,f.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,y.default)("/api/weixin/pay",{method:"post",body:(0,d.default)(t)}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.unionPay=function(){var e=(0,f.default)(i.default.mark(function e(t){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:window.open("/api/weixin/unionPay");case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),t.getWeiXinConfig=function(){var e=(0,f.default)(i.default.mark(function e(){return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,y.default)("/api/weixin/js",{method:"post"}));case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),t.getDetailsAddress=function(){var e=(0,f.default)(i.default.mark(function e(t){var r,n;return i.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=t.LatLng.split(","),n=r[1]+","+r[0],e.abrupt("return",(0,y.default)("/api/weixin/address?lnglat="+n,{method:"get"}));case 3:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}();t.selectOpenIdCorrespondingCode=a,t.createOrder=o,t.payDo=u;var p=r(167),y=n(p),g=u,h=u;t.wxPartyDuesChannelPay=g,t.ccbDragonPay=h},425:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=r(7),o=n(a),u=r(175),c=n(u),i=r(60),s=n(i),d=r(168),l=n(d);r(169);var f=r(94),p=r(1066),y=r(106),g=n(y),h=r(607),v=n(h),b=r(59),m=n(b),x=r(830);r(468);t.default={namespace:"login",state:{openId:null,loggedIn:!1,code:null,role:null},subscriptions:{setup:function(e){var t=e.dispatch;e.history.listen(function(e){var r=e.pathname,n=e.search,a=v.default.parse(n),o=a.open_id,u=void 0===o?null:o;"/login"==r||"/managebind"==r?u&&(console.warn("\u5df2\u83b7\u53d6 openId "+u+"\uff0c\u5f00\u59cb\u81ea\u52a8\u767b\u5f55\uff01"),t({type:"success",payload:{openId:u}})):t((0,g.default)("/Transfers/outer").exec(r)?{type:"quickLogin",payload:{type:"weixin",code:u}}:{type:"restore",payload:{}})})}},effects:{fetch:s.default.mark(function e(t,r){var n,a,o,u,c,i,d,y,g=t.payload,h=r.call,b=r.put,m=r.select;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.default.loading("\u7ed1\u5b9a\u4e2d...",20),e.next=3,m(function(e){return e.login});case 3:return n=e.sent,a=n.openId,g.openid=a,e.next=8,h(p.bind,g);case 8:if(o=e.sent,u=o.data,200!=u.code){e.next=22;break}return l.default.hide(),c=u.ret.userCode,i=u.ret.admin,d=i?1:0,y=i?"org":"person",e.next=18,b({type:"reload",payload:{openId:a,code:c,role:y}});case 18:return e.next=20,b(f.routerRedux.push({pathname:"/success/bing",search:v.default.stringify({code:c,admin:d})}));case 20:e.next=23;break;case 22:l.default.fail(u.msg,3);case 23:case"end":return e.stop()}},e,this)}),fetchs:s.default.mark(function e(t,r){var n,a,o,u,c,i,d,y,g=t.payload,h=r.call,b=r.put,m=r.select;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return l.default.loading("\u7ed1\u5b9a\u4e2d...",20),e.next=3,m(function(e){return e.login});case 3:return n=e.sent,a=n.openId,g.open_id=a,e.next=8,h(p.userBinding,g);case 8:if(o=e.sent,u=o.data,200!=u.code){e.next=27;break}if(l.default.fail(u.ret.msg,3),1!=u.ret.is_succeed){e.next=24;break}return l.default.hide(),c=u.ret.userCode,i=u.ret.admin,d=i?1:0,y=i?"org":"person",e.next=20,b({type:"reload",payload:{openId:a,code:c,role:y}});case 20:return e.next=22,b(f.routerRedux.push({pathname:"/success/bing",search:v.default.stringify({code:c,admin:d})}));case 22:e.next=25;break;case 24:l.default.fail(u.ret.msg,3);case 25:e.next=28;break;case 27:l.default.fail(u.msg,3);case 28:case"end":return e.stop()}},e,this)}),quickLogin:s.default.mark(function e(t,r){var n,a,o,u,i,d,f,y,g,h,v,b,m,x,w,k,j,I,C,O,_,R,M=t.payload,D=r.call,E=r.put;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=M.type,a=void 0===n?"normal":n,o=M.role,u=void 0===o?"person":o,i=M.code,d=null,e.t0=a,e.next="weixin"===e.t0?5:(e.t0,17);break;case 5:return e.next=7,D(p.selectOpenIdCorrespondingCode,{openId:i});case 7:if(f=e.sent,y=f.data,y=void 0===y?{}:y,g=y.code,h=void 0===g?0:g,v=y.msg,b=void 0===v?"\u83b7\u53d6open_id\u5bf9\u5e94\u7528\u6237\u4fe1\u606f\u5931\u8d25\uff01":v,m=y.ret,x=void 0===m?{}:m,200===h){e.next=14;break}return l.default.fail(b),e.abrupt("return",null);case 14:return w=(0,c.default)(x,1),k=w[0],j=k.code,I=void 0===j?null:j,C=k.open_id,O=void 0===C?null:C,_=k.org_code,R=void 0===_?null:_,d=I,e.abrupt("break",19);case 17:return d=i,e.abrupt("break",19);case 19:return e.next=21,E({type:"recovery",payload:{role:u,code:d}});case 21:case"end":return e.stop()}},e,this)}),reload:s.default.mark(function e(t,r){var n,a,o,u,c,i,d=t.payload,l=r.put;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=d.code,a=d.role,o=d.openId,u=d.loggedIn,c=void 0===u||u,i={code:n,role:a,loggedIn:c},sessionStorage.setItem("code",n),sessionStorage.setItem("role",a),m.default.isEmpty(o)||m.default.set(i,"openId",o),e.next=7,l({type:"success",payload:i});case 7:case"end":return e.stop()}},e,this)}),restore:s.default.mark(function e(t,r){var n,a,o,u=(t.payload,r.put),c=r.select;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=sessionStorage.getItem("code"),a=sessionStorage.getItem("role"),e.next=4,c(function(e){return e.login});case 4:if(o=e.sent,!n||!a){e.next=14;break}return e.next=8,u({type:"success",payload:{loggedIn:!0}});case 8:if(o.code===n&&o.role===a){e.next=14;break}return console.warn("\u6b63\u5728\u6062\u590d\u767b\u5f55\u4fe1\u606f"),e.next=12,u({type:"success",payload:{role:a,code:n}});case 12:return e.next=14,u({type:"recovery",payload:{role:a,code:n}});case 14:case"end":return e.stop()}},e,this)}),recovery:s.default.mark(function e(t,r){var n,a,o,u,c=t.payload,i=r.put;r.call;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.role,a=void 0===n?null:n,o=c.code,u=void 0===o?null:o,e.next=3,(0,x.sleep)(100);case 3:e.t0=a,e.next="org"===e.t0?6:"person"===e.t0?9:12;break;case 6:return e.next=8,i({type:"orgLayout/fetch",payload:{MemCode:u}});case 8:return e.abrupt("break",14);case 9:return e.next=11,i({type:"personLayout/fetch",payload:{memCode:u,code:"phone_selectUserInfo",args:[{key:"code",value:[u]}]}});case 11:return e.abrupt("break",14);case 12:return console.warn("\u65e0\u6cd5\u5224\u65ad\u9700\u8981\u6062\u590d\u6570\u636e\u7684\u8eab\u4efd\uff01 role:"+a+" code:"+u),e.abrupt("break",14);case 14:case"end":return e.stop()}},e,this)})},reducers:{success:function(e,t){return(0,o.default)({},e,t.payload)}}},e.exports=t.default},468:function(e,t){function r(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(e.toString==a)switch(e.toString()){case"[object File]":case"[object Map]":case"[object Set]":return 0===e.size;case"[object Object]":for(var t in e)if(n.call(e,t))return!1;return!0}return!1}var n=Object.prototype.hasOwnProperty,a=Object.prototype.toString;e.exports=r},607:function(e,t,r){"use strict";function n(e){switch(e.arrayFormat){case"index":return function(t,r,n){return null===r?[o(t,e),"[",n,"]"].join(""):[o(t,e),"[",o(n,e),"]=",o(r,e)].join("")};case"bracket":return function(t,r){return null===r?o(t,e):[o(t,e),"[]=",o(r,e)].join("")};default:return function(t,r){return null===r?o(t,e):[o(t,e),"=",o(r,e)].join("")}}}function a(e){var t;switch(e.arrayFormat){case"index":return function(e,r,n){if(t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),!t)return void(n[e]=r);void 0===n[e]&&(n[e]={}),n[e][t[1]]=r};case"bracket":return function(e,r,n){return t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0===n[e]?void(n[e]=[r]):void(n[e]=[].concat(n[e],r)):void(n[e]=r)};default:return function(e,t,r){if(void 0===r[e])return void(r[e]=t);r[e]=[].concat(r[e],t)}}}function o(e,t){return t.encode?t.strict?s(e):encodeURIComponent(e):e}function u(e){return Array.isArray(e)?e.sort():"object"==typeof e?u(Object.keys(e)).sort(function(e,t){return Number(e)-Number(t)}).map(function(t){return e[t]}):e}function c(e){var t=e.indexOf("?");return-1===t?"":e.slice(t+1)}function i(e,t){t=d({arrayFormat:"none"},t);var r=a(t),n=Object.create(null);return"string"!=typeof e?n:(e=e.trim().replace(/^[?#&]/,""))?(e.split("&").forEach(function(e){var t=e.replace(/\+/g," ").split("="),a=t.shift(),o=t.length>0?t.join("="):void 0;o=void 0===o?null:l(o),r(l(a),o,n)}),Object.keys(n).sort().reduce(function(e,t){var r=n[t];return Boolean(r)&&"object"==typeof r&&!Array.isArray(r)?e[t]=u(r):e[t]=r,e},Object.create(null))):n}var s=r(608),d=r(101),l=r(609);t.extract=c,t.parse=i,t.stringify=function(e,t){t=d({encode:!0,strict:!0,arrayFormat:"none"},t),!1===t.sort&&(t.sort=function(){});var r=n(t);return e?Object.keys(e).sort(t.sort).map(function(n){var a=e[n];if(void 0===a)return"";if(null===a)return o(n,t);if(Array.isArray(a)){var u=[];return a.slice().forEach(function(e){void 0!==e&&u.push(r(n,e,u.length))}),u.join("&")}return o(n,t)+"="+o(a,t)}).filter(function(e){return e.length>0}).join("&"):""},t.parseUrl=function(e,t){return{url:e.split("?")[0]||"",query:i(c(e),t)}}},608:function(e,t,r){"use strict";e.exports=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}},609:function(e,t,r){"use strict";function n(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var r=e.slice(0,t),a=e.slice(t);return Array.prototype.concat.call([],n(r),n(a))}function a(e){try{return decodeURIComponent(e)}catch(a){for(var t=e.match(u),r=1;r<t.length;r++)e=n(t,r).join(""),t=e.match(u);return e}}function o(e){for(var t={"%FE%FF":"\ufffd\ufffd","%FF%FE":"\ufffd\ufffd"},r=c.exec(e);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch(e){var n=a(r[0]);n!==r[0]&&(t[r[0]]=n)}r=c.exec(e)}t["%C2"]="\ufffd";for(var o=Object.keys(t),u=0;u<o.length;u++){var i=o[u];e=e.replace(new RegExp(i,"g"),t[i])}return e}var u=new RegExp("%[a-f0-9]{2}","gi"),c=new RegExp("(%[a-f0-9]{2})+","gi");e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return o(e)}}},830:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getRuleDate=t.mouthChange=t.formatDate=t.jsonToObject=t.sleep=void 0;var n=r(63),a=function(e){return e&&e.__esModule?e:{default:e}}(n),o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return new a.default(function(t){return setTimeout(t,e)})},u=function(e){try{return JSON.parse(e)}catch(e){return null}},c=function(e,t){var r=e instanceof Date?e:new Date(e.replace(/-/g,"/")),n=t||"yyyy-MM-dd hh:mm:ss",a={"M+":r.getMonth()+1,"d+":r.getDate(),"h+":r.getHours(),"m+":r.getMinutes(),"s+":r.getSeconds(),"q+":Math.floor((r.getMonth()+3)/3),S:r.getMilliseconds()};/(y+)/.test(n)&&(n=n.replace(RegExp.$1,(r.getFullYear()+"").substr(4-RegExp.$1.length)));for(var o in a)new RegExp("("+o+")").test(n)&&(n=n.replace(RegExp.$1,1===RegExp.$1.length?a[o]:("00"+a[o]).substr((""+a[o]).length)));return n},i=function(e){return new Date(e.replace(/-/g,"/"))},s=function(e){var t=void 0;switch(e){case 1:t="January";break;case 2:t="February";break;case 3:t="March";break;case 4:t="April";break;case 5:t="May";break;case 6:t="June";break;case 7:t="July";break;case 8:t="August";break;case 9:t="September";break;case 10:t="October";break;case 11:t="November";break;case 12:t="December"}return t};t.sleep=o,t.jsonToObject=u,t.formatDate=c,t.mouthChange=s,t.getRuleDate=i}});